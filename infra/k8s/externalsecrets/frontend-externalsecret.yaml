# =============================================================================
# TARJETA CRC - infra/k8s/externalsecrets/frontend-externalsecret.yaml
# =============================================================================
# Responsabilidades:
# - Definir ExternalSecret opcional para variables del frontend.
# - Crear el Secret `ragcorp-frontend-secrets` si se decide usar env sensibles.
#
# Colaboradores:
# - infra/helm/ragcorp/values.yaml (frontend.extraEnv)
# - docs/runbook/security-rotation.md
#
# Invariantes:
# - Requiere External Secrets Operator (ESO).
# - Solo usar si el frontend consume secretos via env.
# =============================================================================

# REQUIERE External Secrets Operator.
# Este recurso es opcional. Usar solo si el frontend necesita envs sensibles.
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: ragcorp-frontend-external-secret
  namespace: ragcorp
  labels:
    app.kubernetes.io/name: ragcorp
    app.kubernetes.io/component: secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: REPLACE_ME_SECRET_STORE
    kind: ClusterSecretStore
  target:
    name: ragcorp-frontend-secrets
    creationPolicy: Owner
  data:
    - secretKey: RAG_BACKEND_URL
      remoteRef:
        key: ragcorp/<tenant>/<env>/rag_backend_url
    - secretKey: JWT_COOKIE_DOMAIN
      remoteRef:
        key: ragcorp/<tenant>/<env>/jwt_cookie_domain
